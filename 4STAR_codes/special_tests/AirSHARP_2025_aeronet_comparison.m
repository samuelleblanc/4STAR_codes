%% AirSHARP_2025_aeronet_comparison
%% script to call multiple aeronet comparisons 4starb.
% goes through each flight day and gets the comparisons to nearby aeronet
% sites based on time of overflight.
clear all;

%fp_starsun = '\\192.168.10.201\data\sunsat\AirSHARP_2025\data_processed\allstarmats\';
%fp_aero = '\\192.168.10.201\data\sunsat\AirSHARP_2025\data_processed\aeronet\';

fp_aero = 'C:\Users\sleblan2\Research\AirSHARP\data_2025\aeronet\';
fp_starsun = 'C:\Users\sleblan2\Research\AirSHARP\data_2025\allstarmats\';

%asktosave = 1; %set if ask to save the figures


%% setting up the looping details
i_run = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];
%i_run = [18,19,20,21,22,23];

%fignames = ['AirSHARP2025'];

aeronet_file_paths = {['Marina\'];...
                      ['Marina\'];...
                      ['Marina\'];...
                      ['Marina\'];...
                      ['Marina\'];...
                      ['Marina\'];...
                      ['Marina\'];...
                      ['Marina\'];...
                      ['Marina\'];...
                      ['Marina\'];...
                      ['Marina\'];...
                      ['Marina\'];...
                      ['Marina\'];...
                      ['Marina\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['CEOBS\'];...
                      ['Monterey\'];...
                      ['Monterey\']};

aeronet_valid_time = { [datenum(2025,05,05,20,40,58) datenum(2025,05,05,21,42,15)];...
                       [datenum(2025,05,05,23,29,30) datenum(2025,05,05,23,34,15)];...
                       [datenum(2025,5,6,21,10,0),datenum(2025,5,6,21,11,0)];...
                       [datenum(2025,05,09,16,49,30) datenum(2025,05,09,17,06,52)];...
                        [datenum(2025,05,09,17,16,10) datenum(2025,05,09,17,20,15)];...
                        [datenum(2025,05,09,21,21,10) datenum(2025,05,09,21,30,07)];...
                        [datenum(2025,05,10,16,54,30) datenum(2025,05,10,17,22,15)];...
                        [datenum(2025,05,10,22,20,30) datenum(2025,05,10,22,35,15)];...
                        [datenum(2025,05,14,18,20,30) datenum(2025,05,14,19,0,15)];...
                        [datenum(2025,05,14,22,5,30) datenum(2025,05,14,22,25,15)];...
                        [datenum(2025,05,15,17,4,30) datenum(2025,05,15,17,45,15)];...
                       [datenum(2025,5,18,17,20,0),datenum(2025,5,18,18,20,0)];...
                       [datenum(2025,5,18,21,3,0),datenum(2025,5,18,21,25,0)];...
                       [datenum(2025,5,19,17,45,0),datenum(2025,5,19,18,50,0)];...
                       [datenum(2025,5,19,21,45,0),datenum(2025,5,19,22,0,0)];...
                       [datenum(2025,05,05,22,40,38) datenum(2025,05,05,22,42,15)];...%CEOBS
                       [datenum(2025,05,09,17,2,18) datenum(2025,05,09,17,4,45)];...
                       [datenum(2025,05,09,19,6,18) datenum(2025,05,09,19,10,45)];...
                       [datenum(2025,05,09,20,17,12) datenum(2025,05,09,20,20,15)];...
                       [datenum(2025,05,10,18,25,12) datenum(2025,05,10,18,35,15)];...
                       [datenum(2025,05,10,20,11,12) datenum(2025,05,10,20,15,15)];...
                       [datenum(2025,05,10,20,45,12) datenum(2025,05,10,20,52,15)];...
                       [datenum(2025,05,10,21,23,12) datenum(2025,05,10,21,30,15)];...
                       [datenum(2025,05,14,20,50,12) datenum(2025,05,14,20,55,35)];...
                       [datenum(2025,05,15,18,12,12) datenum(2025,05,15,18,16,35)];...
                       [datenum(2025,05,18,18,32,12) datenum(2025,05,18,18,38,35)];...
                       [datenum(2025,05,19,19,04,12) datenum(2025,05,19,19,13,35)];...
                       [datenum(2025,05,14,21,35,12) datenum(2025,05,14,21,39,35)];...%monterey
                       [datenum(2025,05,15,20,26,12) datenum(2025,05,15,20,32,35)];...
                       };
starsun_file_date = {['20250505'];...
                     ['20250505'];...
                     ['20250506'];...
                     ['20250509'];...
                     ['20250509'];...
                     ['20250509'];...
                     ['20250510'];...
                     ['20250510'];...
                     ['20250514'];...
                     ['20250514'];...
                     ['20250515'];...
                     ['20250518'];...
                     ['20250518'];...
                     ['20250519'];...
                     ['20250519'];...
                     ['20250505'];...%CEOBS
                     ['20250509'];...
                     ['20250509'];...
                     ['20250509'];...
                     ['20250510'];...
                     ['20250510'];...
                     ['20250510'];...
                     ['20250510'];...
                     ['20250514'];...
                     ['20250515'];...
                     ['20250518'];...
                     ['20250519'];...
                     ['20250514'];...
                     ['20250515'];...
                     };
suff = {'1','2','1','1','2','3','1','2','1','2','1','1','2','1','2','1','1','2','3','1','2','3','4','1','1','1','1','1','1','1'};
%supp = {'AirSHARP pre2025';'TMF avg';'AirSHARP2024';'AERONET';'AERONET';...
%        'AERONET';'AERONET';'AERONET';...
%        'AERONET'};
    
n = length(aeronet_valid_time);

%% prepare to save a PowerPoint file
set(groot, 'defaultAxesTickLabelInterpreter','None'); set(groot, 'defaultLegendInterpreter','None');
set(groot, 'defaultAxesTitle','None'); 

pptcontents={}; % pairs of a figure file name and the number of figures per slide
pptcontents0={};

%% Start the loop 
for i=1:length(i_run)
    i_now = i_run(i);
    fname_4starsun = [fp_starsun '4STARB_' starsun_file_date{i_now} 'starsun.mat'];

    %% Compare to AERONET
    try
        setnamedpath('aeronet',[fp_aero aeronet_file_paths{i_now}]);
        loose_aeronet_comparison = false;
        aeronet_fig_paths = compare_star_2_aeronet(fname_4starsun,loose_aeronet_comparison,aeronet_valid_time{i_now},suff{i_now});
    catch e
        disp(['Error making plots for AERONET files: ' e.identifier e.message])
        aeronet_fig_paths = [];
    end
    if length(aeronet_fig_paths)>0
        pptcontents0=[pptcontents0; {aeronet_fig_paths{1} 1}];
        pptcontents0=[pptcontents0; {aeronet_fig_paths{2} 4}];
        pptcontents0=[pptcontents0; {aeronet_fig_paths{3} 4}];
        pptcontents0=[pptcontents0; {' ' 4}];
        pptcontents0=[pptcontents0; {' ' 4}];
        if length(aeronet_fig_paths)>3
            pptcontents0=[pptcontents0; {aeronet_fig_paths{4} 1}];
            pptcontents0=[pptcontents0; {aeronet_fig_paths{5} 1}];
            pptcontents0=[pptcontents0; {aeronet_fig_paths{6} 1}];
            if length(aeronet_fig_paths)>6
                pptcontents0=[pptcontents0; {aeronet_fig_paths{6} 4}];
                pptcontents0=[pptcontents0; {aeronet_fig_paths{7} 4}];
                pptcontents0=[pptcontents0; {aeronet_fig_paths{8} 4}];
                pptcontents0=[pptcontents0; {aeronet_fig_paths{9} 4}];
            end
        end
    end
end

%********************
% Generate a new PowerPoint file
%********************
% sort out the PowerPoint contents
idx4=[];
for ii=1:size(pptcontents0,1)
    if pptcontents0{ii,2}==1
        pptcontents=[pptcontents; {pptcontents0(ii,1)}];
    elseif pptcontents0{ii,2}==4
        idx4=[idx4 ii];
        if numel(idx4)==4 || ii==size(pptcontents0,1) || pptcontents0{ii+1,2}~=4
            if numel(idx4)>=3
                pptcontents=[pptcontents; {pptcontents0(idx4,1)}];
            else
                pptcontents=[pptcontents; {[pptcontents0(idx4,1);' ';' ']}];
            end;
            idx4=[];
        end
    else
        error('Paste either 1 or 4 figures per slide.');
    end
end
ppt_fname = [ fp_aero '4STARB_aeronet_compare_AirSHARP2025.pptx'];
disp(['Writing Quicklooks to ' ppt_fname])
makepptx(ppt_fname, '4STARB vs AERONET for AirSHARP 2025', pptcontents{:});





